blueprint:
  name: Auto-lock door after duration (only if closed)
  description: >
    When the selected lock has been UNLOCKED for the chosen duration, lock it
    only if the contact sensor reports CLOSED. If the door is open, send a
    notification.
  domain: automation
  input:
    lock_entity:
      name: Door lock
      selector:
        entity:
          domain: lock
    contact_entity:
      name: Door contact sensor
      description: Usually 'off' = closed, 'on' = open.
      selector:
        entity:
          domain: binary_sensor
          device_class: door
    unlock_duration:
      name: Time unlocked before auto-lock
      default: 00:05:00
      selector:
        duration:
    notify_service:
      name: Notify service
      description: e.g. notify.mobile_app_fold_6
      selector:
        text:

mode: restart

trigger:
  - platform: state
    entity_id: !input lock_entity
    to: "unlocked"
    for: !input unlock_duration

condition: []

action:
  - choose:
      # ✅ Door is CLOSED -> lock it
      - conditions:
          - condition: state
            entity_id: !input contact_entity
            state: "off"   # 'off' = closed for most door contacts
        sequence:
          - service: lock.lock
            target:
              entity_id: !input lock_entity
    # ❌ Door is OPEN -> notify
    default:
      - service: !input notify_service
        data:
          title: "🚪 Auto-lock skipped"
          message: "The door is open, so auto-lock did not run."
